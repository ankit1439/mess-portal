<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - College Mess Portal</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .admin-dashboard {
            min-height: 100vh;
            background: #f8f9fa;
        }
        
        .admin-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .admin-header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .admin-title h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .admin-title p {
            opacity: 0.9;
            font-size: 0.9rem;
        }
        
        .admin-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .admin-user {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .admin-user span {
            font-weight: 500;
        }
        
        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .admin-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            text-align: center;
        }
        
        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }
        
        .admin-tabs {
            display: flex;
            background: white;
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            flex-wrap: wrap;
        }
        
        .tab-btn {
            flex: 1;
            min-width: 120px;
            padding: 15px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 10px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .tab-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .data-table th,
        .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
        }
        
        .data-table tr:hover {
            background: #f8f9fa;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-resolved {
            background: #d4edda;
            color: #155724;
        }
        
        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-right: 5px;
        }
        
        .btn-view {
            background: #667eea;
            color: white;
        }
        
        .btn-resolve {
            background: #28a745;
            color: white;
        }
        
        .btn-view-photo {
            background: #17a2b8;
            color: white;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .no-data {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .chart-container {
            margin-top: 20px;
            height: 400px;
            position: relative;
        }
        
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .chart-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }
        
        .pdf-upload-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .pdf-upload-form {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .pdf-upload-form input[type="file"] {
            flex: 1;
            min-width: 200px;
            padding: 10px;
            border: 2px dashed #667eea;
            border-radius: 8px;
            background: white;
        }
        
        .upload-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: transform 0.3s ease;
        }
        
        .upload-btn:hover {
            transform: translateY(-2px);
        }
        
        .current-pdf {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid #e1e5e9;
        }
        
        .current-pdf h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        
        .current-pdf a {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
        }
        
        .current-pdf a:hover {
            text-decoration: underline;
        }
        
        .photo-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
        }
        
        .photo-modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 90%;
            max-height: 90%;
        }
        
        .photo-modal-content img {
            width: 100%;
            height: auto;
            border-radius: 10px;
        }
        
        .close-photo {
            position: absolute;
            top: -40px;
            right: 0;
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="admin-dashboard">
        <!-- Admin Header -->
        <div class="admin-header">
            <div class="admin-header-content">
                <div class="admin-title">
                    <h1>üìä Admin Dashboard</h1>
                    <p>College Mess Feedback Portal - Analytics & Management</p>
                </div>
                <div class="admin-actions">
                    <div class="admin-user">
                        <span>üë§ <span id="adminUsername">Admin</span></span>
                    </div>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            </div>
        </div>

        <!-- Admin Content -->
        <div class="admin-content">
            <!-- Statistics Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üó≥Ô∏è</div>
                    <div class="stat-number" id="totalVotes">0</div>
                    <div class="stat-label">Total Votes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üí¨</div>
                    <div class="stat-number" id="totalFeedback">0</div>
                    <div class="stat-label">Feedback Received</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚ö†Ô∏è</div>
                    <div class="stat-number" id="totalComplaints">0</div>
                    <div class="stat-label">Complaints</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìù</div>
                    <div class="stat-number" id="totalSuggestions">0</div>
                    <div class="stat-label">Menu Suggestions</div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="admin-tabs">
                <button class="tab-btn active" onclick="showTab('feedback')">Feedback</button>
                <button class="tab-btn" onclick="showTab('complaints')">Complaints</button>
                <button class="tab-btn" onclick="showTab('votes')">Voting Data</button>
                <button class="tab-btn" onclick="showTab('suggestions')">Menu Suggestions</button>
                <button class="tab-btn" onclick="showTab('analytics')">Analytics</button>
                <button class="tab-btn" onclick="showTab('menu-pdf')">Menu PDF</button>
            </div>

            <!-- Tab Content -->
            <div class="tab-content">
                <!-- Feedback Tab -->
                <div id="feedback-tab" class="tab-panel">
                    <h3>üìù User Feedback</h3>
                    <div id="feedback-table-container">
                        <div class="loading">Loading feedback data...</div>
                    </div>
                </div>

                <!-- Complaints Tab -->
                <div id="complaints-tab" class="tab-panel" style="display: none;">
                    <h3>‚ö†Ô∏è User Complaints</h3>
                    <div id="complaints-table-container">
                        <div class="loading">Loading complaints data...</div>
                    </div>
                </div>

                <!-- Votes Tab -->
                <div id="votes-tab" class="tab-panel" style="display: none;">
                    <h3>üó≥Ô∏è Voting Statistics</h3>
                    <div id="votes-table-container">
                        <div class="loading">Loading voting data...</div>
                    </div>
                </div>

                <!-- Suggestions Tab -->
                <div id="suggestions-tab" class="tab-panel" style="display: none;">
                    <h3>üí° Menu Suggestions</h3>
                    <div id="suggestions-table-container">
                        <div class="loading">Loading suggestions data...</div>
                    </div>
                </div>

                <!-- Analytics Tab -->
                <div id="analytics-tab" class="tab-panel" style="display: none;">
                    <h3>üìä Analytics Dashboard</h3>
                    <div class="chart-grid">
                        <div class="chart-card">
                            <div class="chart-title">Feedback Ratings Distribution</div>
                            <div class="chart-container">
                                <canvas id="ratingChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <div class="chart-title">Complaints by Category</div>
                            <div class="chart-container">
                                <canvas id="complaintChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <div class="chart-title">Voting Activity (Last 7 Days)</div>
                            <div class="chart-container">
                                <canvas id="votingChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <div class="chart-title">Popular Dishes</div>
                            <div class="chart-container">
                                <canvas id="dishChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Menu PDF Tab -->
                <div id="menu-pdf-tab" class="tab-panel" style="display: none;">
                    <h3>üìÑ Menu PDF Management</h3>
                    <div class="pdf-upload-section">
                        <h4>Upload New Menu PDF</h4>
                        <form id="pdfUploadForm" class="pdf-upload-form">
                            <input type="file" id="menuPdfFile" name="menuPdfFile" accept=".pdf" required>
                            <button type="submit" class="upload-btn">Upload PDF</button>
                        </form>
                        <div id="currentPdf" class="current-pdf">
                            <h4>Current Menu PDF</h4>
                            <p>No PDF uploaded yet.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Photo Modal -->
    <div id="photoModal" class="photo-modal">
        <div class="photo-modal-content">
            <span class="close-photo" onclick="closePhotoModal()">&times;</span>
            <img id="modalPhoto" src="" alt="Complaint Photo">
        </div>
    </div>

    <script>
        // Check authentication
        function checkAuth() {
            const token = localStorage.getItem('adminToken');
            if (!token) {
                window.location.href = 'admin-login.html';
                return;
            }
            
            const username = localStorage.getItem('adminUsername');
            if (username) {
                document.getElementById('adminUsername').textContent = username;
            }
        }

        // Logout function
        function logout() {
            localStorage.removeItem('adminToken');
            localStorage.removeItem('adminUsername');
            window.location.href = 'admin-login.html';
        }

        // Tab switching
        function showTab(tabName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-panel');
            tabs.forEach(tab => tab.style.display = 'none');
            
            // Remove active class from all buttons
            const buttons = document.querySelectorAll('.tab-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName + '-tab').style.display = 'block';
            
            // Add active class to clicked button
            event.target.classList.add('active');
            
            // Load data for the tab
            loadTabData(tabName);
        }

        // Load data for tabs
        async function loadTabData(tabName) {
            const token = localStorage.getItem('adminToken');
            
            try {
                let endpoint = '';
                let containerId = '';
                
                switch(tabName) {
                    case 'feedback':
                        endpoint = '/api/admin/feedback';
                        containerId = 'feedback-table-container';
                        break;
                    case 'complaints':
                        endpoint = '/api/admin/complaints';
                        containerId = 'complaints-table-container';
                        break;
                    case 'votes':
                        endpoint = '/api/admin/votes';
                        containerId = 'votes-table-container';
                        break;
                    case 'suggestions':
                        endpoint = '/api/admin/menu-suggestions';
                        containerId = 'suggestions-table-container';
                        break;
                    case 'analytics':
                        loadAnalytics();
                        return;
                    case 'menu-pdf':
                        loadCurrentPdf();
                        return;
                }
                
                if (endpoint) {
                    const response = await fetch(endpoint, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        displayData(tabName, result.data, containerId);
                    } else {
                        document.getElementById(containerId).innerHTML = 
                            '<div class="no-data">No data available</div>';
                    }
                }
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById(containerId).innerHTML = 
                    '<div class="no-data">Error loading data</div>';
            }
        }

        // Display data in tables
        function displayData(tabName, data, containerId) {
            let html = '';
            
            switch(tabName) {
                case 'feedback':
                    html = createFeedbackTable(data);
                    break;
                case 'complaints':
                    html = createComplaintsTable(data);
                    break;
                case 'votes':
                    html = createVotesTable(data);
                    break;
                case 'suggestions':
                    html = createSuggestionsTable(data);
                    break;
            }
            
            document.getElementById(containerId).innerHTML = html;
        }

        // Create feedback table
        function createFeedbackTable(data) {
            if (!data || data.length === 0) {
                return '<div class="no-data">No feedback data available</div>';
            }
            
            let html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Message</th>
                            <th>Rating</th>
                            <th>Date</th>
                            <th>IP Address</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            data.forEach(item => {
                html += `
                    <tr>
                        <td>${item.feedback_type}</td>
                        <td>${item.message}</td>
                        <td>${'‚≠ê'.repeat(item.rating || 0)}</td>
                        <td>${new Date(item.timestamp).toLocaleDateString()}</td>
                        <td>${item.ip_address}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            return html;
        }

        // Create complaints table with photo support
        function createComplaintsTable(data) {
            if (!data || data.length === 0) {
                return '<div class="no-data">No complaints data available</div>';
            }
            
            let html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Message</th>
                            <th>Urgency</th>
                            <th>Status</th>
                            <th>Photos</th>
                            <th>Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            data.forEach(item => {
                const statusClass = item.status === 'pending' ? 'status-pending' : 'status-resolved';
                const photos = item.photos ? JSON.parse(item.photos) : [];
                const photoButtons = photos.map((photo, index) => 
                    `<button class="action-btn btn-view-photo" onclick="viewPhoto('${photo}', ${item.id})">Photo ${index + 1}</button>`
                ).join('');
                
                html += `
                    <tr>
                        <td>${item.category}</td>
                        <td>${item.message}</td>
                        <td>${item.urgency}</td>
                        <td><span class="status-badge ${statusClass}">${item.status}</span></td>
                        <td>${photoButtons || 'No photos'}</td>
                        <td>${new Date(item.timestamp).toLocaleDateString()}</td>
                        <td>
                            <button class="action-btn btn-view" onclick="viewComplaint(${item.id})">View</button>
                            ${item.status === 'pending' ? 
                                `<button class="action-btn btn-resolve" onclick="resolveComplaint(${item.id})">Resolve</button>` : 
                                ''
                            }
                        </td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            return html;
        }

        // Create votes table
        function createVotesTable(data) {
            if (!data || data.length === 0) {
                return '<div class="no-data">No voting data available</div>';
            }
            
            let html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Day</th>
                            <th>Meal</th>
                            <th>Dish</th>
                            <th>Votes</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            data.forEach(item => {
                html += `
                    <tr>
                        <td>${item.day}</td>
                        <td>${item.meal}</td>
                        <td>${item.dish}</td>
                        <td>${item.vote_count || 1}</td>
                        <td>${new Date(item.timestamp).toLocaleDateString()}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            return html;
        }

        // Create suggestions table
        function createSuggestionsTable(data) {
            if (!data || data.length === 0) {
                return '<div class="no-data">No suggestions data available</div>';
            }
            
            let html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Dish Name</th>
                            <th>Meal Type</th>
                            <th>Ingredients</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            data.forEach(item => {
                html += `
                    <tr>
                        <td>${item.dish_name}</td>
                        <td>${item.meal_type}</td>
                        <td>${item.ingredients || 'N/A'}</td>
                        <td>${new Date(item.timestamp).toLocaleDateString()}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            return html;
        }

        // Load analytics charts
        async function loadAnalytics() {
            const token = localStorage.getItem('adminToken');
            
            try {
                const response = await fetch('/api/admin/dashboard', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    createRatingChart(result.stats.rating_distribution);
                    createComplaintChart(result.stats.complaints_by_urgency);
                    createVotingChart(result.stats.recent_activity);
                    createDishChart(result.stats.popular_dishes);
                }
            } catch (error) {
                console.error('Error loading analytics:', error);
            }
        }

        // Create rating distribution chart
        function createRatingChart(data) {
            const ctx = document.getElementById('ratingChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: data.map(item => `${item.rating} Stars`),
                    datasets: [{
                        data: data.map(item => item.count),
                        backgroundColor: [
                            '#ff6b6b', '#ffa726', '#ffeb3b', '#4caf50', '#2196f3'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        // Create complaint category chart
        function createComplaintChart(data) {
            const ctx = document.getElementById('complaintChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(item => item.urgency),
                    datasets: [{
                        label: 'Number of Complaints',
                        data: data.map(item => item.count),
                        backgroundColor: '#667eea'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Create voting activity chart
        function createVotingChart(data) {
            const ctx = document.getElementById('votingChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Votes', 'Feedback', 'Complaints'],
                    datasets: [{
                        label: 'Last 7 Days Activity',
                        data: [data.votes_last_7_days, data.feedback_last_7_days, data.complaints_last_7_days],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Create popular dishes chart
        function createDishChart(data) {
            const ctx = document.getElementById('dishChart').getContext('2d');
            new Chart(ctx, {
                type: 'horizontalBar',
                data: {
                    labels: data.map(item => item.dish),
                    datasets: [{
                        label: 'Votes',
                        data: data.map(item => item.votes),
                        backgroundColor: '#764ba2'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Load current PDF
        async function loadCurrentPdf() {
            const token = localStorage.getItem('adminToken');
            
            try {
                const response = await fetch('/api/current-pdf', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const result = await response.json();
                
                if (result.success && result.data.filename) {
                    document.getElementById('currentPdf').innerHTML = `
                        <h4>Current Menu PDF</h4>
                        <a href="/uploads/${result.data.filename}" target="_blank">${result.data.filename}</a>
                        <p>Uploaded: ${new Date(result.data.upload_date).toLocaleDateString()}</p>
                    `;
                } else {
                    document.getElementById('currentPdf').innerHTML = `
                        <h4>Current Menu PDF</h4>
                        <p>No PDF uploaded yet.</p>
                    `;
                }
            } catch (error) {
                console.error('Error loading current PDF:', error);
            }
        }

        // Handle PDF upload
        document.getElementById('pdfUploadForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData();
            const fileInput = document.getElementById('menuPdfFile');
            formData.append('pdf_file', fileInput.files[0]);
            
            const token = localStorage.getItem('adminToken');
            
            try {
                const response = await fetch('/api/upload-pdf', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    },
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('PDF uploaded successfully!');
                    loadCurrentPdf();
                    fileInput.value = '';
                } else {
                    alert('Upload failed: ' + result.error);
                }
            } catch (error) {
                console.error('Upload error:', error);
                alert('Upload failed. Please try again.');
            }
        });

        // Photo modal functions
        function viewPhoto(photoUrl, complaintId) {
            document.getElementById('modalPhoto').src = photoUrl;
            document.getElementById('photoModal').style.display = 'block';
        }

        function closePhotoModal() {
            document.getElementById('photoModal').style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('photoModal');
            if (event.target === modal) {
                closePhotoModal();
            }
        }

        // Load statistics
        async function loadStatistics() {
            const token = localStorage.getItem('adminToken');
            
            try {
                const response = await fetch('/api/admin/dashboard', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('totalVotes').textContent = result.stats.totals.votes || 0;
                    document.getElementById('totalFeedback').textContent = result.stats.totals.feedback || 0;
                    document.getElementById('totalComplaints').textContent = result.stats.totals.complaints || 0;
                    document.getElementById('totalSuggestions').textContent = result.stats.totals.menu_suggestions || 0;
                }
            } catch (error) {
                console.error('Error loading statistics:', error);
            }
        }

        // Initialize dashboard
        function initDashboard() {
            checkAuth();
            loadStatistics();
            loadTabData('feedback');
        }

        // Action functions
        function viewComplaint(id) {
            alert(`Viewing complaint ID: ${id}`);
        }

        function resolveComplaint(id) {
            if (confirm('Mark this complaint as resolved?')) {
                // Implement resolve functionality
                alert(`Complaint ${id} marked as resolved`);
                loadTabData('complaints');
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initDashboard);
    </script>
</body>
</html>
